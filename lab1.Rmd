---
title: "cars16_1_26"
output: html_document
date: "2026-01-16"
author: "Mario Fernando Rocha 23501, Luis Pedro Lira 23669,Juan Francisco Martínez 23617"

---
```{r}

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r paquetes}
library(nortest)
library(ggplot2)
library(dplyr)
library(cluster) #Para calcular la silueta
library(e1071)#para cmeans
library(mclust) #mixtures of gaussians
library(fpc) #para hacer el plotcluster
library(NbClust) #Para determinar el número de clusters óptimo
library(factoextra) #Para hacer gráficos bonitos de clustering
library(hopkins) #Para revisar si vale la pena hacer agrupamiento
library(GGally) #Para hacer el conjunto de graficos
library(FeatureImpCluster) #Para revisar la importancia de las variables en los grupos.
library(pheatmap) #Para hacer mapa de calor
library(scales)  #Para las escalas de la gráficas
```

#  Análisis exploratorio de Datos

## Carros

```{r carga_datos}
movies <- read.csv("movies_2026.csv")
head(movies)

```
### Pregunta 1:  Exploración rápida de los Datos

#Dimensiones
```{r}
nrow(movies) #númdro de Filas 
ncol(movies) #número de Columnas
dim(movies) #dimensión del Data Set


names(movies) # Nombres de columna


str(movies) # Estructura (tipos de datos)


summary(movies) # Resumen rápido (por defecto)
```
#Datos Faltantes y Duplicados
```{r}
# Cantidad de NA por columna
na_conteo <- colSums(is.na(movies))

# Porcentaje de NA por columna
na_porcentaje <- round(colMeans(is.na(movies)) * 100, 2)

# Tabla resumen de faltantes
faltantes <- data.frame(
  variable = names(movies),
  na = as.vector(na_conteo),
  na_pct = as.vector(na_porcentaje)
)


head(faltantes, 15)  # Top 15 columnas con más NA

# Duplicados (filas repetidas)
sum(duplicated(movies))

```
#Resumen de variables Numéricas
```{r}
# Detectar columnas numéricas
num_cols <- sapply(movies, is.numeric)
datos_num <- movies[, num_cols]

# Resumen estadístico simple por variable numérica
res_num <- data.frame(
  variable = names(datos_num),
  media = sapply(datos_num, mean, na.rm = TRUE),
  mediana = sapply(datos_num, median, na.rm = TRUE),
  sd = sapply(datos_num, sd, na.rm = TRUE),
  min = sapply(datos_num, min, na.rm = TRUE),
  max = sapply(datos_num, max, na.rm = TRUE)
)

head(res_num)

```
#variables Categóricas
```{r}
cat_cols <- sapply(movies, is.character) | sapply(movies, is.factor)
names(movies[, cat_cols])
```
### Pregunta número 2
```{r}
variable_type <- data.frame(
  Variable = names(movies),
  Tipo = c(
    "Cuantitativa discreta", "Cuantitativa continua", "Cuantitativa continua",
    "Cuantitativa continua", "Cualitativa nominal", "Cualitativa nominal",
    "Cualitativa nominal", "Cualitativa nominal", "Cualitativa nominal",
    "Cualitativa nominal", "Cuantitativa continua", "Cualitativa nominal",
    "Cuantitativa discreta", "Cualitativa nominal", "Cuantitativa discreta",
    "Cualitativa nominal", "Cualitativa nominal", "Cuantitativa discreta",
    "Cualitativa nominal", "Cuantitativa discreta", "Cuantitativa continua",
    "Cualitativa nominal", "Cuantitativa continua", "Cualitativa nominal",
    "Cuantitativa discreta", "Cuantitativa discreta", "Cuantitativa discreta",
    "Cuantitativa discreta"
  )
)

variable_type
```
###Pregunta número 3

## Separar las variables
```{r}
vars_cuant <- variable_type$Variable[grepl("Cuantitativa", variable_type$Tipo)]
vars_cual  <- variable_type$Variable[grepl("Cualitativa", variable_type$Tipo)]

vars_cuant
vars_cual
```
##normalizar
```{r}

set.seed(123)

normalidad_list <- lapply(vars_cuant, function(v){
  x <- movies[[v]]
  x <- x[!is.na(x)]
  x <- x[is.finite(x)]   # por si hay Inf/NaN

  n <- length(x)

  if(n < 3){
    return(data.frame(
      Variable = v,
      n = n,
      muestra = n,
      p_value = NA,
      decision = "No aplica (n<3)"
    ))
  }

  m <- min(n, 5000)
  xs <- sample(x, m)

  p <- shapiro.test(xs)$p.value
  decision <- ifelse(p < 0.05, "Rechaza normalidad", "No rechaza normalidad")

  data.frame(
    Variable = v,
    n = n,
    muestra = m,
    p_value = p,
    decision = decision
  )
})

normalidad <- bind_rows(normalidad_list) %>%
  arrange(p_value)

normalidad
```
##Pregunta 4

###Top 10 películas con más presupuesto
```{r}
top10_budget <- movies %>%
  filter(!is.na(budget)) %>%
  arrange(desc(budget)) %>%
  select(title, budget, revenue, releaseYear) %>%
  head(10)

top10_budget
```
###Top 10 películas con más ingresos
```{r}
top10_revenue <- movies %>%
  filter(!is.na(revenue)) %>%
  arrange(desc(revenue)) %>%
  select(title, revenue, budget, releaseYear) %>%
  head(10)

top10_revenue
```
### Película con más votos
```{r}
pelicula_mas_votos <- movies %>%
  filter(!is.na(voteCount)) %>%
  arrange(desc(voteCount)) %>%
  select(title, voteCount, voteAvg, revenue, budget, releaseYear) %>%
  head(1)

pelicula_mas_votos
```
### Película con menos votos
```{r}
peliculas_0_votos <- movies %>%
  filter(!is.na(voteCount), voteCount == 0) %>%
  select(title, voteCount, voteAvg, releaseYear)

peliculas_0_votos

min_votos_pos <- movies %>%
  filter(!is.na(voteCount), voteCount > 0) %>%
  summarise(min_voteCount = min(voteCount)) %>%
  pull(min_voteCount)

peliculas_menos_votos_con_voto <- movies %>%
  filter(!is.na(voteCount), voteCount == min_votos_pos) %>%
  select(title, voteCount, voteAvg, releaseYear)

min_votos_pos
peliculas_menos_votos_con_voto
```
###Películas por año
```{r}
peliculas_por_anio <- movies %>%
  filter(!is.na(releaseYear)) %>%
  mutate(releaseYear = as.integer(releaseYear)) %>%
  count(releaseYear, name = "cantidad") %>%
  arrange(releaseYear)

anio_mas <- peliculas_por_anio %>%
  slice_max(cantidad, n = 1, with_ties = FALSE)

ggplot(peliculas_por_anio, aes(x = releaseYear, y = cantidad)) +
  geom_col(width = 0.85) +
  geom_text(
    data = anio_mas,
    aes(label = paste0("Máximo: ", releaseYear, "\n(", comma(cantidad), ")")),
    vjust = -0.4,
    size = 3.5
  ) +
  scale_x_continuous(
    breaks = seq(min(pelis_por_anio$releaseYear), max(pelis_por_anio$releaseYear), by = 5)
  ) +
  scale_y_continuous(labels = comma) +
  labs(
    title = "Cantidad de películas por año",
    x = "Año",
    y = "Cantidad de películas"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    panel.grid.minor = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )
```

