---
title: "cars16_1_26"
output: html_document
date: "2026-01-16"
author: "Mario Fernando Rocha 23501, Luis Pedro Lira 23669,Juan Francisco Martínez 23617"

---
```{r}

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r paquetes}
library(nortest)
library(ggplot2)
library(dplyr)
library(cluster) #Para calcular la silueta
library(e1071)#para cmeans
library(mclust) #mixtures of gaussians
library(fpc) #para hacer el plotcluster
library(NbClust) #Para determinar el número de clusters óptimo
library(factoextra) #Para hacer gráficos bonitos de clustering
library(hopkins) #Para revisar si vale la pena hacer agrupamiento
library(GGally) #Para hacer el conjunto de graficos
library(FeatureImpCluster) #Para revisar la importancia de las variables en los grupos.
library(pheatmap) #Para hacer mapa de calor
```

#  Análisis exploratorio de Datos

## Carros

```{r carga_datos}
movies <- read.csv("movies_2026.csv")
head(movies)

```
### Pregunta 1:  Exploración rápida de los Datos

#Dimensiones
```{r}
nrow(movies) #númdro de Filas 
ncol(movies) #número de Columnas
dim(movies) #dimensión del Data Set


names(movies) # Nombres de columna


str(movies) # Estructura (tipos de datos)


summary(movies) # Resumen rápido (por defecto)
```
#Datos Faltantes y Duplicados
```{r}
# Cantidad de NA por columna
na_conteo <- colSums(is.na(movies))

# Porcentaje de NA por columna
na_porcentaje <- round(colMeans(is.na(movies)) * 100, 2)

# Tabla resumen de faltantes
faltantes <- data.frame(
  variable = names(movies),
  na = as.vector(na_conteo),
  na_pct = as.vector(na_porcentaje)
)


head(faltantes, 15)  # Top 15 columnas con más NA

# Duplicados (filas repetidas)
sum(duplicated(movies))

```
#Resumen de variables Numéricas
```{r}
# Detectar columnas numéricas
num_cols <- sapply(movies, is.numeric)
datos_num <- movies[, num_cols]

# Resumen estadístico simple por variable numérica
res_num <- data.frame(
  variable = names(datos_num),
  media = sapply(datos_num, mean, na.rm = TRUE),
  mediana = sapply(datos_num, median, na.rm = TRUE),
  sd = sapply(datos_num, sd, na.rm = TRUE),
  min = sapply(datos_num, min, na.rm = TRUE),
  max = sapply(datos_num, max, na.rm = TRUE)
)

head(res_num)

```
#variables Categóricas
```{r}
cat_cols <- sapply(movies, is.character) | sapply(movies, is.factor)
names(movies[, cat_cols])
```
### Pregunta número 2
```{r}
variable_type <- data.frame(
  Variable = names(movies),
  Tipo = c(
    "Cuantitativa discreta", "Cuantitativa continua", "Cuantitativa continua",
    "Cuantitativa continua", "Cualitativa nominal", "Cualitativa nominal",
    "Cualitativa nominal", "Cualitativa nominal", "Cualitativa nominal",
    "Cualitativa nominal", "Cuantitativa continua", "Cualitativa nominal",
    "Cuantitativa discreta", "Cualitativa nominal", "Cuantitativa discreta",
    "Cualitativa nominal", "Cualitativa nominal", "Cuantitativa discreta",
    "Cualitativa nominal", "Cuantitativa discreta", "Cuantitativa continua",
    "Cualitativa nominal", "Cuantitativa continua", "Cualitativa nominal",
    "Cuantitativa discreta", "Cuantitativa discreta", "Cuantitativa discreta",
    "Cuantitativa discreta"
  )
)

variable_type
```
###Pregunta número 3

## Separar las variables
```{r}
vars_cuant <- variable_type$Variable[grepl("Cuantitativa", variable_type$Tipo)]
vars_cual  <- variable_type$Variable[grepl("Cualitativa", variable_type$Tipo)]

vars_cuant
vars_cual
```
##normalizar
```{r}
library(dplyr)

set.seed(123)

normalidad_list <- lapply(vars_cuant, function(v){
  x <- movies[[v]]
  x <- x[!is.na(x)]
  x <- x[is.finite(x)]   # por si hay Inf/NaN

  n <- length(x)

  if(n < 3){
    return(data.frame(
      Variable = v,
      n = n,
      muestra = n,
      p_value = NA,
      decision = "No aplica (n<3)"
    ))
  }

  m <- min(n, 5000)
  xs <- sample(x, m)

  p <- shapiro.test(xs)$p.value
  decision <- ifelse(p < 0.05, "Rechaza normalidad", "No rechaza normalidad")

  data.frame(
    Variable = v,
    n = n,
    muestra = m,
    p_value = p,
    decision = decision
  )
})

normalidad <- bind_rows(normalidad_list) %>%
  arrange(p_value)

normalidad
```

```{r}
library(dplyr)
library(ggplot2)
library(lubridate)

```


```{r}
str(movies)
summary(movies)
```


## 5. Análisis Exploratorio Adicional
En esta sección se plantean seis preguntas adicionales con el objetivo de explorar patrones
complementarios en el conjunto de datos, sin repetir los análisis realizados en los incisos
anteriores.

```{r}
movies_clean <- movies %>%
  filter(
    !is.na(revenue),
    !is.na(popularity),
    !is.na(runtime),
    !is.na(productionCountriesAmount),
    !is.na(genresAmount),
    !is.na(productionCoAmount),
    !is.na(castWomenAmount),
    !is.na(castMenAmount),
    !is.na(originalLanguage),
    !is.na(releaseYear)
  )
```


### 5.1 ¿Existe diferencia en los ingresos según la cantidad de países de producción?
```{r}
ggplot(movies_clean, aes(x = factor(productionCountriesAmount), y = revenue)) +
  geom_boxplot() +
  labs(
    x = "Cantidad de países de producción",
    y = "Ingresos",
    title = "Ingresos según cantidad de países de producción"
  ) +
  theme_minimal()
```

### 5.2 ¿La cantidad de géneros influye en la popularidad y calificación de las películas?
```{r}
ggplot(movies_clean, aes(x = genresAmount, y = popularity)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    x = "Cantidad de géneros",
    y = "Popularidad",
    title = "Relación entre cantidad de géneros y popularidad"
  ) +
  theme_minimal()
```
### 5.3 ¿Cómo ha cambiado la duración promedio de las películas a lo largo del tiempo?

```{r}
runtime_year <- movies_clean %>%
  group_by(releaseYear) %>%
  summarise(runtime_promedio = mean(runtime))

ggplot(runtime_year, aes(x = releaseYear, y = runtime_promedio)) +
  geom_line() +
  geom_point() +
  labs(
    x = "Año de lanzamiento",
    y = "Duración promedio (minutos)",
    title = "Evolución de la duración promedio de las películas"
  ) +
  theme_minimal()
```

### 5.4 ¿Las películas con más compañías productoras generan mayores ingresos?
```{r}
ggplot(movies_clean, aes(x = factor(productionCoAmount), y = revenue)) +
  geom_boxplot() +
  labs(
    x = "Cantidad de compañías productoras",
    y = "Ingresos",
    title = "Ingresos según número de compañías productoras"
  ) +
  theme_minimal()
```
### 5.5 ¿Existen diferencias en la popularidad de las películas según su idioma original?
En este análisis se consideran únicamente los idiomas más frecuentes en el conjunto de datos,
con el fin de evitar sesgos causados por idiomas con muy pocas observaciones.

```{r}
# Seleccionar los 5 idiomas más frecuentes
top_languages <- movies_clean %>%
  group_by(originalLanguage) %>%
  summarise(n = n()) %>%
  arrange(desc(n)) %>%
  slice_head(n = 5)
```

```{r}
# Filtrar solo películas en esos idiomas
movies_lang <- movies_clean %>%
  filter(originalLanguage %in% top_languages$originalLanguage)
```

```{r}
# Calcular popularidad promedio por idioma
pop_lang <- movies_lang %>%
  group_by(originalLanguage) %>%
  summarise(popularidad_promedio = mean(popularity))
```

```{r}
# Gráfico de barras
ggplot(pop_lang, aes(
  x = reorder(originalLanguage, -popularidad_promedio),
  y = popularidad_promedio
)) +
  geom_col() +
  labs(
    x = "Idioma original",
    y = "Popularidad promedio",
    title = "Popularidad promedio según idioma original"
  ) +
  theme_minimal()
```
### 5.6 ¿El balance de género en el elenco influye en la popularidad de las películas?
```{r}
movies_gender <- movies_clean %>%
  mutate(ratio_genero = castWomenAmount / castMenAmount) %>%
  filter(is.finite(ratio_genero))
```

```{r}
ggplot(movies_gender, aes(x = ratio_genero, y = popularity)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    x = "Ratio mujeres / hombres en el elenco",
    y = "Popularidad",
    title = "Relación entre balance de género y popularidad"
  ) +
  theme_minimal()
```

