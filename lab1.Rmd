---
title: "cars16_1_26"
output: html_document
date: "2026-01-16"
author: "Juan Francisco Martínez 23617"

---
```{r}

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r paquetes}
library(nortest)
library(ggplot2)
library(dplyr)
library(cluster) #Para calcular la silueta
library(e1071)#para cmeans
library(mclust) #mixtures of gaussians
library(fpc) #para hacer el plotcluster
library(NbClust) #Para determinar el número de clusters óptimo
library(factoextra) #Para hacer gráficos bonitos de clustering
library(hopkins) #Para revisar si vale la pena hacer agrupamiento
library(GGally) #Para hacer el conjunto de graficos
library(FeatureImpCluster) #Para revisar la importancia de las variables en los grupos.
library(pheatmap) #Para hacer mapa de calor
```

#  Análisis exploratorio de Datos

## Carros

```{r carga_datos}
carros <- read.csv("../Datos/cars.csv")

```
### Descripción del conjunto de Datos
El conjunto de datos está formado por `r nrow(carros)` observaciones y `r ncol(carros)` variables. 

#### Variables: 

1. **symboling: **              
-3, -2, -1, 0, 1, 2, 3.
  2. **normalized-losses:**        
numérico 65 hasta 256.
  3. **make:**                     
alfa-romero, audi, bmw, chevrolet, dodge, honda, isuzu, jaguar, mazda, mercedes-benz, mercury, mitsubishi, nissan, peugot, plymouth, porsche,  renault, saab, subaru, hastayota, volkswagen, volvo
  4. **fuel-type:**               
diesel, gas.
  5. **aspiration:**              
std, turbo.
  6. **num-of-doors:**            
four, two.
  7. **body-style:**              
hardtop, wagon, sedan, hatchback, convertible.
  8. **drive-wheels:**            
4wd, fwd, rwd.

 9. **engine-location:**         
front, rear.
 10. **wheel-base:**              
numérico desde 86.6 hasta 120.9.
 11. **length: **                 
numérico desde 141.1 hasta 208.1.
 12. **width:**                   
numérico desde 60.3 hasta 72.3.
 13. **height:**                  
numérico desde 47.8 hasta 59.8.
14. **curb-weight: **            
numérico desde 1488 hasta 4066.
 15. **engine-type:**             
dohc, dohcv, l, ohc, ohcf, ohcv, rotor.
 16. **num-of-cylinders:**        
eight, five, four, six, three, twelve, two.
 17. **engine-size:**             
numérico desde 61 to 326.
 18. **fuel-system:**             
1bbl, 2bbl, 4bbl, idi, mfi, mpfi, spdi, spfi.
 19. **bore: **                   
numérico desde 2.54 hasta 3.94.
 20. **stroke:**                  
numérico desde 2.07 hasta 4.17.
 21. **compression-ratio:**       
numérico desde 7 hasta 23. 
 22.**horsepower:**              
numérico desde 48 hasta 288.
 23. **peak-rpm:**               
numérico desde 4150 hasta 6600.
 24. **city-mpg:**                
numérico desde 13 hasta 49.
 25. **highway-mpg:**             
numérico desde 16 hasta 54.
 26. **price:**                  
numérico desde 5118 hasta 45400.

#### Variables numéricas
```{r variables_numéricas}
numericas <- c(
  "engine_size","price","length","width","height","horsepower",
  "city_mpg","highway_mpg","curb_weight","wheel_base",
  "normalized_losses","bore","stroke","compression_ratio","peak_rpm"
)

carros_num <- carros[, numericas, drop = FALSE]

```

#### Medidas de Tendencia central
```{r}
mean(carros_num$normalized_losses, na.rm = TRUE)
median(carros_num$normalized_losses, na.rm = TRUE)
max(carros_num$normalized_losses, na.rm = TRUE)
min(carros_num$normalized_losses, na.rm = TRUE)carros_cat <- carros[,!names(carros) %in% numericas]

sd(carros_num$normalized_losses, na.rm = TRUE)
quantile(carros_num$normalized_losses, na.rm = TRUE)
quantile(carros_num$normalized_losses, probs = seq(0, 1, 0.1), na.rm = TRUE)

summary(carros_num)
```

```{r normalidad_variables}
hist(carros_num$price)
boxplot(carros_num$price)





shapiro.test(carros_num$price)
ks.test(carros_num$price,"pnorm",mean=mean(carros_num$price, na.rm= TRUE), sd = sd(carros_num$price, na.rm= TRUE))
lillie.test(carros_num$price)
```

```{r}
shapiro.test(carros_num$engine_size)
ks.test(carros_num$engine_size,"pnorm",mean=mean(carros_num$engine_size, na.rm= TRUE), sd = sd(carros_num$price, na.rm= TRUE))
lillie.test(carros_num$engine_size)
```
```{r}
shapiro.test(carros_num$length)
ks.test(carros_num$length,"pnorm",mean=mean(carros_num$length, na.rm= TRUE), sd = sd(carros_num$length, na.rm= TRUE))
lillie.test(carros_num$length)
```
```{r}
shapiro.test(carros_num$width)
ks.test(carros_num$width,"pnorm",mean=mean(carros_num$width, na.rm= TRUE), sd = sd(carros_num$width, na.rm= TRUE))
lillie.test(carros_num$width)
```
```{r}
shapiro.test(carros_num$height)
ks.test(carros_num$height,"pnorm",mean=mean(carros_num$height, na.rm= TRUE), sd = sd(carros_num$height, na.rm= TRUE))
lillie.test(carros_num$height)
```
```{r}
shapiro.test(carros_num$horsepower)
ks.test(carros_num$horsepower,"pnorm",mean=mean(carros_num$horsepower, na.rm= TRUE), sd = sd(carros_num$horsepower, na.rm= TRUE))
lillie.test(carros_num$horsepower)
```
```{r}
shapiro.test(carros_num$city_mpg)
ks.test(carros_num$city_mpg,"pnorm",mean=mean(carros_num$city_mpg, na.rm= TRUE), sd = sd(carros_num$city_mpg, na.rm= TRUE))
lillie.test(carros_num$city_mpg)
```
```{r}
shapiro.test(carros_num$highway_mpg)
ks.test(carros_num$highway_mpg,"pnorm",mean=mean(carros_num$highway_mpg, na.rm= TRUE), sd = sd(carros_num$highway_mpg, na.rm= TRUE))
lillie.test(carros_num$highway_mpg)
```
```{r}
shapiro.test(carros_num$curb_weight)
ks.test(carros_num$curb_weight,"pnorm",mean=mean(carros_num$curb_weight, na.rm= TRUE), sd = sd(carros_num$curb_weight, na.rm= TRUE))
lillie.test(carros_num$curb_weight)
```
```{r}
shapiro.test(carros_num$wheel_base)
ks.test(carros_num$wheel_base,"pnorm",mean=mean(carros_num$wheel_base, na.rm= TRUE), sd = sd(carros_num$wheel_base, na.rm= TRUE))
lillie.test(carros_num$wheel_base)
```
```{r}
shapiro.test(carros_num$normalized_losses)
ks.test(carros_num$normalized_losses,"pnorm",mean=mean(carros_num$normalized_losses, na.rm= TRUE), sd = sd(carros_num$normalized_losses, na.rm= TRUE))
lillie.test(carros_num$normalized_losses)
```
```{r}
shapiro.test(carros_num$bore)
ks.test(carros_num$bore,"pnorm",mean=mean(carros_num$bore, na.rm= TRUE), sd = sd(carros_num$bore, na.rm= TRUE))
lillie.test(carros_num$bore)
```
```{r}
shapiro.test(carros_num$stroke)
ks.test(carros_num$stroke,"pnorm",mean=mean(carros_num$stroke, na.rm= TRUE), sd = sd(carros_num$stroke, na.rm= TRUE))
lillie.test(carros_num$stroke)
```
```{r}
shapiro.test(carros_num$compression_ratio)
ks.test(carros_num$compression_ratio,"pnorm",mean=mean(carros_num$compression_ratio, na.rm= TRUE), sd = sd(carros_num$compression_ratio, na.rm= TRUE))
lillie.test(carros_num$compression_ratio)
```
```{r}
shapiro.test(carros_num$peak_rpm)
ks.test(carros_num$peak_rpm,"pnorm",mean=mean(carros_num$peak_rpm, na.rm= TRUE), sd = sd(carros_num$peak_rpm, na.rm= TRUE))
lillie.test(carros_num$peak_rpm)
```
```{r normalized_losses}
hist(carros_num$normalized_losses)
boxplot(carros_num$normalized_losses)
lillie.test(carros_num$normalized_losses)

```
####Symboling
esta es una variable que representa el indicie de peligrosidad de un carro. Se puede observar que no hay carros en la categpría -3 y son muy pocos (1.25%) en la categoría -2. La mayoría de datos está entre 0 y 1 (58%) por lo que son las categorías dominantes en esta variable. El nivel de peligrosidad de los autos es alto en general. 
```{r variables_categoricas}
table(carros_cat$symboling)
barplot(table(carros_cat$symboling),main = "Distribución de symboling",
        xlab="symboling", ylab="Frecuencia",
        col = c("red","green","pink","blue","yellow","orange"))
prop.table(table(carros_cat$symboling))*100
```
#### Make
```{r marca}
tabla <- prop.table(table(carros_cat$make))*100
df_make <- as.data.frame(tabla)
colnames(df_make)<- c ("Marca","Porcentaje")

ggplot(df_make, aes(x = Marca, y = Porcentaje, fill = Marca)) +
  geom_bar(stat = "identity") +
  ggtitle("Porcentaje de carros por Marca") +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )
```

#### Fuel Type
```{r combustible}
tabla <- prop.table(table(carros_cat$fuel_type))*100
df_fuel_type <- as.data.frame(tabla)
colnames(df_fuel_type)<- c ("Tipo","Porcentaje")

ggplot(df_fuel_type, aes(x = Tipo, y = Porcentaje, fill = Tipo)) +
  geom_bar(stat = "identity") +
  ggtitle("Porcentaje de carros por Tipo de Combustible") +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )
```
#### Aspiration
```{r Aspiration}
tabla <- prop.table(table(carros_cat$aspiration))*100
df_aspiration <- as.data.frame(tabla)
colnames(df_aspiration)<- c ("Tipo","Porcentaje")

ggplot(df_aspiration, aes(x = Tipo, y = Porcentaje, fill = Tipo)) +
  geom_bar(stat = "identity") +
  ggtitle("Porcentaje de carros por Tipo de Motor") +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )
```
#### Fuel Type
```{r combustible}
tabla <- prop.table(table(carros_cat$num_of_doors))*100
df_num_of_doors <- as.data.frame(tabla)
colnames(df_num_of_doors)<- c ("Puertas","Porcentaje")

ggplot(df_num_of_doors, aes(x = Puertas, y = Porcentaje, fill = Puertas)) +
  geom_bar(stat = "identity") +
  ggtitle("Porcentaje de carros por cantidad de Puertas") +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )
```

```{r}
df_carros_make<- carros %>%
  group_by(make)%>%
  summarise(mean_price = mean(price, na.rm = TRUE))%>%
  arrange(desc(mean_price))
```


#Ejercicio 30/1/2026

Pasos para hacer Clustering
1, Averiguar si vale la pena agrupar (Hopkins, VAT)

2. Determinar el numero de grupos
  - Grafica de codo (ward)
  -NbClust

3. Hacer el CLustering
  -K-means
  -Jerarquico (ward)
  -Mixture of Gaussians
  
4. Validar Grupos 
  -Silhouette
  -Cardinalidad
  _Importancia de las variables

5. Interpretar Grupos
  -Medias por Grupo
  -Distribucion de categorias por grupo 
  
  
  
  
##Paso 1
```{r esccalado de Datos}
carros_num_norm <- as.data.frame(scale(carros_num))

carros_num_norm <- na.omit(carros_num_norm)
```
```{r hopkins}
set.seed(123)
hopkins(carros_num_norm)
```
##Paso 2
```{r Evaluación Visual de Tendencia}
#Matriz de distancia
datos_dist <- dist(carros_num_norm)

# Visualización
fviz_dist(datos_dist, show_labels = FALSE)
```


```{r metodo de codo}
wss = 0
for (i in 1:10) 
  wss[i] <- sum(kmeans(carros_num_norm, centers = i)$withinss)

plot(1:10, wss, type = "b", xlab = "Number of Clusters", ylab = "Within groups sum of squares")
```
```{r nbClust}
nb <- NbClust(carros_num_norm, distance = "euclidean", min.nc = 2,
              max.nc = 10, method = "complete", index = "all")

```

##Paso 3

```{r kmedias}
km <- kmeans(carros_num_norm, 3, iter.max = 100)
carros_num_norm$grupo <- km$cluster
```
```{r resumen de las kmedias}
km

```
```{r Jerarquico WARD}
datos_dist <- dist(carros_num_norm, method = "euclidean")

hc <- hclust(datos_dist, method = "ward.D2")

plot(hc, cex = 0.6)

carros_num_norm$gruposHC <- cutree(hc, k = 3)
```

```{r Gaussians}
gmm <- Mclust(carros_num_norm, G = 2:10)

plot(gmm, what = "BIC")

carros_num_norm$gruposGMM <- gmm$classification
```

##Paso 4
```{r Siluetas}
X <- carros_num_norm
X <- X[, !names(X) %in% c("grupo","gruposHC","gruposGMM")]  # por si existen
km <- kmeans(X, 3, iter.max = 100)

silkm <- silhouette(km$cluster, dist(X))

```
```{r Grafico de Siluetas}
plot(silkm, cex.names = .4, col = 1:3)

```


```{r cardinalidad de los grupos km}
km$size
```

```{r Importancia de Variables}
library(flexclust)
library(data.table)

set.seed(123)
res <- kcca(carros_num_norm, 3)

importance <- FeatureImpCluster(res, as.data.table(carros_num_norm))
plot(importance)
```

```{r}
barplot(res, bycluster=T)
```

## Paso 5
```{r Interpretador de grupos }
fviz_dend(hc, k = 3, cex = .2, horiz = TRUE)

```

```{r medias por grupo}
by(carros_num_norm[, !names(carros_num_norm) %in% c("grupo","gruposHC","gruposGMM")],
   carros_num_norm$gruposHC,
   colMeans)
```
```{r Distribucion grupoHC}
tabla <- table(carros[rownames(carros_num_norm), "fuel_type"],
               carros_num_norm$gruposHC)

prop <- prop.table(tabla, 2)

barplot(prop, beside = TRUE, legend = TRUE,
        xlab = "Grupo", ylab = "Proporción")
```
```{r Distribucion grupo }
tabla <- table(carros[rownames(carros_num_norm), "fuel_type"],
               carros_num_norm$grupo)

prop <- prop.table(tabla, 2)

barplot(prop, beside = TRUE, legend = TRUE,
        xlab = "Grupo", ylab = "Proporción")
```
```{r Distribucion gruposGMM}
tabla <- table(carros[rownames(carros_num_norm), "fuel_type"],
               carros_num_norm$gruposGMM)

prop <- prop.table(tabla, 2)

barplot(prop, beside = TRUE, legend = TRUE,
        xlab = "Grupo", ylab = "Proporción")
```

